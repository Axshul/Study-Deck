<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Study-Deck - Visual Study Environment</title>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      overflow: hidden;
      height: 100%;
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    html {
      height: 100%;
    }

    /* Theme Variables */
    body.light {
      --bg-primary: #f8f9fa;
      --bg-secondary: #ffffff;
      --bg-tertiary: #e9ecef;
      --text-primary: #212529;
      --text-secondary: #6c757d;
      --border-color: #dee2e6;
      --shadow: rgba(0, 0, 0, 0.1);
      --accent: #2f80ed;
    }

    body.dark {
      --bg-primary: #1a1a2e;
      --bg-secondary: #16213e;
      --bg-tertiary: #0f3460;
      --text-primary: #eaeaea;
      --text-secondary: #a0a0a0;
      --border-color: #2d3748;
      --shadow: rgba(0, 0, 0, 0.3);
      --accent: #4a9eff;
    }

    body.blue {
      --bg-primary: #e3f2fd;
      --bg-secondary: #bbdefb;
      --bg-tertiary: #90caf9;
      --text-primary: #0d47a1;
      --text-secondary: #1565c0;
      --border-color: #64b5f6;
      --shadow: rgba(33, 150, 243, 0.2);
      --accent: #1976d2;
    }

    body.sepia {
      --bg-primary: #f4f1ea;
      --bg-secondary: #e8dcc4;
      --bg-tertiary: #d4c5a9;
      --text-primary: #3e2723;
      --text-secondary: #5d4037;
      --border-color: #bcaaa4;
      --shadow: rgba(62, 39, 35, 0.15);
      --accent: #8d6e63;
    }

    body {
      background-color: var(--bg-primary);
      color: var(--text-primary);
    }

    /* Navigation Bar */
    .navbar {
      background-color: var(--bg-secondary);
      border-bottom: 2px solid var(--border-color);
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 8px var(--shadow);
      z-index: 100;
    }

    .logo {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--accent);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .nav-menu {
      display: flex;
      gap: 1.5rem;
      list-style: none;
    }

    .nav-menu a {
      color: var(--text-primary);
      text-decoration: none;
      font-weight: 500;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      transition: all 0.3s ease;
    }

    .nav-menu a:hover,
    .nav-menu a.active {
      background-color: var(--bg-tertiary);
      color: var(--accent);
    }

    /* Main Layout */
    .main-container {
      display: flex;
      height: calc(100% - 140px);
    }

    /* Left Panel - Subjects Map */
    .map-panel {
      flex: 1;
      background-color: var(--bg-secondary);
      border-right: 2px solid var(--border-color);
      overflow: hidden;
      position: relative;
    }

    .map-container {
      width: 100%;
      height: 100%;
      position: relative;
      overflow: auto;
      padding: 2rem;
    }

    .node {
      position: absolute;
      padding: 1rem 1.5rem;
      background-color: var(--bg-primary);
      border: 2px solid;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px var(--shadow);
      min-width: 120px;
      text-align: center;
      font-weight: 600;
    }

    .node:hover {
      transform: scale(1.05) translateY(-4px);
      box-shadow: 0 8px 24px var(--shadow);
      z-index: 10;
    }

    .node.subject {
      font-size: 1.1rem;
      padding: 1.5rem 2rem;
    }

    .node.topic {
      font-size: 0.9rem;
      opacity: 0.9;
    }

    .connection-line {
      position: absolute;
      height: 2px;
      background: linear-gradient(90deg, var(--accent), transparent);
      transform-origin: left center;
      pointer-events: none;
      opacity: 0.4;
      transition: opacity 0.3s ease;
    }

    /* Right Panel - Desk View */
    .desk-panel {
      width: 40%;
      background-color: var(--bg-primary);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .desk-header {
      background-color: var(--bg-secondary);
      padding: 1.5rem;
      border-bottom: 2px solid var(--border-color);
    }

    .desk-header h2 {
      color: var(--accent);
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
    }

    .desk-content {
      flex: 1;
      overflow-y: auto;
      padding: 2rem;
    }

    .welcome-screen {
      text-align: center;
      padding: 4rem 2rem;
    }

    .welcome-screen h3 {
      font-size: 2rem;
      margin-bottom: 1rem;
      color: var(--accent);
    }

    .welcome-screen p {
      color: var(--text-secondary);
      font-size: 1.1rem;
    }

    .content-card {
      background-color: var(--bg-secondary);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      box-shadow: 0 2px 8px var(--shadow);
    }

    .content-card h3 {
      color: var(--accent);
      margin-bottom: 1rem;
    }

    .content-card p {
      line-height: 1.6;
      color: var(--text-secondary);
    }

    .video-embed {
      width: 100%;
      aspect-ratio: 16/9;
      border-radius: 8px;
      margin-top: 1rem;
    }

    .resource-link {
      display: inline-block;
      color: var(--accent);
      text-decoration: none;
      padding: 0.5rem 1rem;
      border: 2px solid var(--accent);
      border-radius: 8px;
      margin-top: 0.5rem;
      transition: all 0.3s ease;
    }

    .resource-link:hover {
      background-color: var(--accent);
      color: white;
    }

    /* Quick Notes Panel */
    .notes-panel {
      display: none;
      padding: 2rem;
      height: 100%;
      overflow-y: auto;
    }

    .notes-panel.active {
      display: block;
    }

    .notes-toggle {
      display: flex;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .notes-toggle button {
      flex: 1;
      padding: 0.75rem;
      border: 2px solid var(--border-color);
      background-color: var(--bg-secondary);
      color: var(--text-primary);
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .notes-toggle button.active {
      background-color: var(--accent);
      color: white;
      border-color: var(--accent);
    }

    .sticky-notes-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 1rem;
    }

    .sticky-note {
      background-color: #ffd54f;
      padding: 1rem;
      border-radius: 8px;
      box-shadow: 0 4px 8px var(--shadow);
      min-height: 150px;
      position: relative;
    }

    .sticky-note textarea {
      width: 100%;
      height: 100px;
      border: none;
      background: transparent;
      resize: none;
      font-family: inherit;
      color: #333;
    }

    .sticky-note button {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      background: rgba(0, 0, 0, 0.1);
      border: none;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      cursor: pointer;
      font-size: 0.8rem;
    }

    .add-note-btn {
      padding: 1rem;
      background-color: var(--accent);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      width: 100%;
      margin-bottom: 1rem;
    }

    .noteit-embed {
      width: 100%;
      height: 600px;
      border: 2px solid var(--border-color);
      border-radius: 8px;
    }

    /* Bottom Toolbar */
    .toolbar {
      background-color: var(--bg-secondary);
      border-top: 2px solid var(--border-color);
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 -2px 8px var(--shadow);
    }

    .theme-switcher {
      display: flex;
      gap: 0.5rem;
    }

    .theme-btn {
      width: 40px;
      height: 40px;
      border: 2px solid var(--border-color);
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .theme-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 4px 12px var(--shadow);
    }

    .theme-btn.light { background: linear-gradient(135deg, #f8f9fa, #e9ecef); }
    .theme-btn.dark { background: linear-gradient(135deg, #1a1a2e, #16213e); }
    .theme-btn.blue { background: linear-gradient(135deg, #e3f2fd, #90caf9); }
    .theme-btn.sepia { background: linear-gradient(135deg, #f4f1ea, #d4c5a9); }

    .toolbar-actions {
      display: flex;
      gap: 1rem;
    }

    .toolbar-btn {
      padding: 0.75rem 1.5rem;
      background-color: var(--accent);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .toolbar-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px var(--shadow);
    }

    .toolbar-btn.secondary {
      background-color: var(--bg-tertiary);
      color: var(--text-primary);
    }

    /* Footer */
    .footer {
      background-color: var(--bg-secondary);
      text-align: center;
      padding: 1rem;
      color: var(--text-secondary);
      font-size: 0.9rem;
      border-top: 1px solid var(--border-color);
    }

    /* Study Timer Widget */
    .timer-widget {
      position: fixed;
      bottom: 80px;
      right: 20px;
      background-color: var(--bg-secondary);
      padding: 1rem;
      border-radius: 12px;
      box-shadow: 0 4px 16px var(--shadow);
      min-width: 200px;
      z-index: 50;
      display: none;
    }

    .timer-widget.active {
      display: block;
    }

    .timer-display {
      font-size: 2rem;
      font-weight: 700;
      text-align: center;
      color: var(--accent);
      margin-bottom: 1rem;
    }

    .timer-controls {
      display: flex;
      gap: 0.5rem;
    }

    .timer-controls button {
      flex: 1;
      padding: 0.5rem;
      border: none;
      background-color: var(--accent);
      color: white;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
    }

    /* Search Bar */
    .search-container {
      margin-bottom: 1rem;
      padding: 0 2rem;
    }

    .search-input {
      width: 100%;
      padding: 0.75rem 1rem;
      border: 2px solid var(--border-color);
      border-radius: 8px;
      background-color: var(--bg-secondary);
      color: var(--text-primary);
      font-size: 1rem;
    }

    /* Mobile Responsive */
    @media (max-width: 768px) {
      .main-container {
        flex-direction: column;
      }

      .desk-panel {
        width: 100%;
        height: 50%;
      }

      .nav-menu {
        gap: 0.5rem;
      }

      .nav-menu a {
        padding: 0.5rem;
        font-size: 0.9rem;
      }

      .toolbar {
        flex-direction: column;
        gap: 1rem;
      }
    }

    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .content-card {
      animation: fadeIn 0.5s ease;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    .node:active {
      animation: pulse 0.3s ease;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body class="light"><!-- Navigation Bar -->
  <nav class="navbar">
   <div class="logo"><span>üìö</span> <span id="app-title">Study-Deck</span>
   </div>
   <ul class="nav-menu">
    <li><a href="#" class="active" data-view="dashboard">Dashboard</a></li>
    <li><a href="#" data-view="map">Subjects Map</a></li>
    <li><a href="#" data-view="notes">Quick Notes</a></li>
    <li><a href="#" data-view="themes">Themes</a></li>
   </ul>
  </nav><!-- Main Container -->
  <div class="main-container"><!-- Left Panel - Subjects Map -->
   <div class="map-panel" id="map-view">
    <div class="search-container"><input type="text" class="search-input" id="search-input" placeholder="üîç Search subjects or topics...">
    </div>
    <div class="map-container" id="map-container"><!-- Nodes will be dynamically generated here -->
    </div>
   </div><!-- Right Panel - Desk View -->
   <div class="desk-panel" id="desk-view">
    <div class="desk-header">
     <h2 id="desk-title">Study Desk</h2>
     <p id="desk-subtitle" style="color: var(--text-secondary); margin-top: 0.5rem;">Your learning workspace</p>
    </div>
    <div class="desk-content" id="desk-content">
     <div class="welcome-screen">
      <h3 id="welcome-title">Welcome to Your Study Desk</h3>
      <p id="welcome-message">Select a subject or topic from the map to begin studying</p>
     </div>
    </div>
   </div><!-- Quick Notes Panel (Hidden by default) -->
   <div class="notes-panel" id="notes-view">
    <h2 style="margin-bottom: 1.5rem; color: var(--accent);">Quick Notes</h2>
    <div class="notes-toggle"><button class="active" data-mode="sticky">Sticky Notes</button> <button data-mode="noteit">NoteIt App</button>
    </div>
    <div id="sticky-notes-area"><button class="add-note-btn" id="add-note-btn">+ Add New Note</button>
     <div class="sticky-notes-container" id="sticky-notes-container"></div>
    </div>
    <div id="noteit-area" style="display: none;"><iframe class="noteit-embed" src="https://perchance.org/noteit-shanks"></iframe>
    </div>
   </div>
  </div><!-- Bottom Toolbar -->
  <div class="toolbar">
   <div class="theme-switcher"><button class="theme-btn light" data-theme="light" title="Light Theme"></button> <button class="theme-btn dark" data-theme="dark" title="Dark Theme"></button> <button class="theme-btn blue" data-theme="blue" title="Blue Theme"></button> <button class="theme-btn sepia" data-theme="sepia" title="Sepia Theme"></button>
   </div>
   <div class="toolbar-actions"><button class="toolbar-btn secondary" id="timer-toggle">‚è±Ô∏è Study Timer</button> <button class="toolbar-btn secondary" id="refresh-btn">üîÑ Refresh</button> <button class="toolbar-btn" id="noteit-btn">üìù Open NoteIt App</button>
   </div>
  </div><!-- Study Timer Widget -->
  <div class="timer-widget" id="timer-widget">
   <div class="timer-display" id="timer-display">
    25:00
   </div>
   <div class="timer-controls"><button id="timer-start">Start</button> <button id="timer-reset">Reset</button>
   </div>
  </div>
  <script>
    // Mock manifest data
    const manifest = {
      subjects: [
        { 
          name: "Mathematics", 
          color: "#2f80ed", 
          topics: ["Algebra", "Geometry", "Calculus"],
          description: "Study of numbers, quantities, and shapes"
        },
        { 
          name: "Physics", 
          color: "#eb5757", 
          topics: ["Mechanics", "Optics", "Thermodynamics"],
          description: "Study of matter, energy, and their interactions"
        },
        { 
          name: "Chemistry", 
          color: "#27ae60", 
          topics: ["Organic", "Inorganic", "Physical"],
          description: "Study of substances and their properties"
        },
        { 
          name: "Computer Science", 
          color: "#f2994a", 
          topics: ["Algorithms", "Data Structures", "Web Development"],
          description: "Study of computation and information"
        },
        { 
          name: "Biology", 
          color: "#9b51e0", 
          topics: ["Genetics", "Ecology", "Cell Biology"],
          description: "Study of living organisms"
        }
      ]
    };

    // Sample content for topics
    const topicContent = {
      "Algebra": {
        title: "Algebra Fundamentals",
        content: "Algebra is a branch of mathematics dealing with symbols and the rules for manipulating those symbols. Key concepts include variables, equations, functions, and polynomials.",
        resources: [
          { name: "Khan Academy - Algebra", url: "https://www.khanacademy.org/math/algebra" },
          { name: "Practice Problems", url: "#" }
        ]
      },
      "Mechanics": {
        title: "Classical Mechanics",
        content: "Mechanics is the study of motion and forces. It includes Newton's laws of motion, energy, momentum, and rotational dynamics.",
        video: "https://www.youtube.com/embed/b1t41Q3xRM8",
        resources: [
          { name: "MIT OpenCourseWare", url: "https://ocw.mit.edu" }
        ]
      },
      "Organic": {
        title: "Organic Chemistry",
        content: "Organic chemistry focuses on carbon-containing compounds. Topics include hydrocarbons, functional groups, reaction mechanisms, and synthesis.",
        resources: [
          { name: "Organic Chemistry Portal", url: "#" }
        ]
      }
    };

    // State management
    let currentView = 'dashboard';
    let currentTheme = localStorage.getItem('studyDeckTheme') || 'light';
    let stickyNotes = JSON.parse(localStorage.getItem('studyDeckNotes') || '[]');
    let timerSeconds = 25 * 60;
    let timerInterval = null;
    let timerRunning = false;

    // Default config for Element SDK
    const defaultConfig = {
      app_title: "Study-Deck",
      tagline: "Your File-Based Study Environment",
      welcome_title: "Welcome to Your Study Desk",
      welcome_message: "Select a subject or topic from the map to begin studying",
      footer_text: "¬© 2025 Study-Deck ‚Äî Your File-Based Study Environment | GitHub Pages Edition"
    };

    // Initialize Element SDK
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig: defaultConfig,
        onConfigChange: async (config) => {
          document.getElementById('app-title').textContent = config.app_title || defaultConfig.app_title;
          document.getElementById('welcome-title').textContent = config.welcome_title || defaultConfig.welcome_title;
          document.getElementById('welcome-message').textContent = config.welcome_message || defaultConfig.welcome_message;
        },
        mapToCapabilities: (config) => ({
          recolorables: [],
          borderables: [],
          fontEditable: undefined,
          fontSizeable: undefined
        }),
        mapToEditPanelValues: (config) => new Map([
          ["app_title", config.app_title || defaultConfig.app_title],
          ["tagline", config.tagline || defaultConfig.tagline],
          ["welcome_title", config.welcome_title || defaultConfig.welcome_title],
          ["welcome_message", config.welcome_message || defaultConfig.welcome_message],
          ["footer_text", config.footer_text || defaultConfig.footer_text]
        ])
      });
    }

    // Initialize app
    function init() {
      switchTheme(currentTheme);
      renderMap();
      loadStickyNotes();
      attachEventListeners();
    }

    // Render subjects map
    function renderMap() {
      const container = document.getElementById('map-container');
      container.innerHTML = '';

      const centerX = container.offsetWidth / 2;
      const centerY = container.offsetHeight / 2;
      const radius = 200;

      manifest.subjects.forEach((subject, index) => {
        const angle = (index / manifest.subjects.length) * 2 * Math.PI;
        const x = centerX + radius * Math.cos(angle) - 60;
        const y = centerY + radius * Math.sin(angle) - 40;

        // Create subject node
        const subjectNode = document.createElement('div');
        subjectNode.className = 'node subject';
        subjectNode.style.left = `${x}px`;
        subjectNode.style.top = `${y}px`;
        subjectNode.style.borderColor = subject.color;
        subjectNode.textContent = subject.name;
        subjectNode.title = subject.description;
        subjectNode.dataset.subject = subject.name;
        
        subjectNode.addEventListener('click', () => openDeskView(subject, null));
        container.appendChild(subjectNode);

        // Create topic nodes
        subject.topics.forEach((topic, topicIndex) => {
          const topicAngle = angle + (topicIndex - 1) * 0.3;
          const topicRadius = radius + 120;
          const topicX = centerX + topicRadius * Math.cos(topicAngle) - 50;
          const topicY = centerY + topicRadius * Math.sin(topicAngle) - 30;

          const topicNode = document.createElement('div');
          topicNode.className = 'node topic';
          topicNode.style.left = `${topicX}px`;
          topicNode.style.top = `${topicY}px`;
          topicNode.style.borderColor = subject.color;
          topicNode.textContent = topic;
          topicNode.dataset.subject = subject.name;
          topicNode.dataset.topic = topic;
          
          topicNode.addEventListener('click', () => openDeskView(subject, topic));
          container.appendChild(topicNode);

          // Draw connection line
          const line = document.createElement('div');
          line.className = 'connection-line';
          const dx = topicX + 50 - (x + 60);
          const dy = topicY + 30 - (y + 40);
          const length = Math.sqrt(dx * dx + dy * dy);
          const angle = Math.atan2(dy, dx) * 180 / Math.PI;
          
          line.style.width = `${length}px`;
          line.style.left = `${x + 60}px`;
          line.style.top = `${y + 40}px`;
          line.style.transform = `rotate(${angle}deg)`;
          line.style.background = `linear-gradient(90deg, ${subject.color}, transparent)`;
          container.appendChild(line);
        });
      });
    }

    // Open desk view with content
    function openDeskView(subject, topic) {
      const deskContent = document.getElementById('desk-content');
      const deskTitle = document.getElementById('desk-title');
      
      if (topic && topicContent[topic]) {
        const content = topicContent[topic];
        deskTitle.textContent = content.title;
        
        let html = `
          <div class="content-card">
            <h3>${content.title}</h3>
            <p>${content.content}</p>
        `;
        
        if (content.video) {
          html += `<iframe class="video-embed" src="${content.video}" frameborder="0" allowfullscreen></iframe>`;
        }
        
        if (content.resources) {
          html += '<div style="margin-top: 1rem;">';
          content.resources.forEach(resource => {
            html += `<a href="${resource.url}" class="resource-link" target="_blank" rel="noopener noreferrer">${resource.name}</a> `;
          });
          html += '</div>';
        }
        
        html += '</div>';
        deskContent.innerHTML = html;
      } else {
        deskTitle.textContent = subject.name;
        let html = `
          <div class="content-card">
            <h3>${subject.name}</h3>
            <p>${subject.description}</p>
            <p style="margin-top: 1rem; color: var(--text-secondary);">Topics in this subject:</p>
            <div style="margin-top: 1rem;">
        `;
        
        subject.topics.forEach(t => {
          html += `<span style="display: inline-block; padding: 0.5rem 1rem; background-color: var(--bg-tertiary); border-radius: 8px; margin: 0.25rem; cursor: pointer;" onclick="openDeskView({name: '${subject.name}', color: '${subject.color}', topics: [], description: '${subject.description}'}, '${t}')">${t}</span>`;
        });
        
        html += '</div></div>';
        deskContent.innerHTML = html;
      }
    }

    // Switch theme
    function switchTheme(theme) {
      document.body.className = theme;
      currentTheme = theme;
      localStorage.setItem('studyDeckTheme', theme);
    }

    // Load sticky notes
    function loadStickyNotes() {
      const container = document.getElementById('sticky-notes-container');
      container.innerHTML = '';
      
      stickyNotes.forEach((note, index) => {
        const noteEl = document.createElement('div');
        noteEl.className = 'sticky-note';
        noteEl.innerHTML = `
          <button onclick="deleteNote(${index})">√ó</button>
          <textarea onchange="updateNote(${index}, this.value)">${note}</textarea>
        `;
        container.appendChild(noteEl);
      });
    }

    // Add sticky note
    function addNote() {
      stickyNotes.push('');
      saveStickyNotes();
      loadStickyNotes();
    }

    // Update sticky note
    function updateNote(index, value) {
      stickyNotes[index] = value;
      saveStickyNotes();
    }

    // Delete sticky note
    function deleteNote(index) {
      stickyNotes.splice(index, 1);
      saveStickyNotes();
      loadStickyNotes();
    }

    // Save sticky notes
    function saveStickyNotes() {
      localStorage.setItem('studyDeckNotes', JSON.stringify(stickyNotes));
    }

    // Timer functions
    function startTimer() {
      if (timerRunning) {
        clearInterval(timerInterval);
        timerRunning = false;
        document.getElementById('timer-start').textContent = 'Start';
        return;
      }
      
      timerRunning = true;
      document.getElementById('timer-start').textContent = 'Pause';
      
      timerInterval = setInterval(() => {
        timerSeconds--;
        updateTimerDisplay();
        
        if (timerSeconds <= 0) {
          clearInterval(timerInterval);
          timerRunning = false;
          timerSeconds = 25 * 60;
          document.getElementById('timer-start').textContent = 'Start';
          updateTimerDisplay();
        }
      }, 1000);
    }

    function resetTimer() {
      clearInterval(timerInterval);
      timerRunning = false;
      timerSeconds = 25 * 60;
      document.getElementById('timer-start').textContent = 'Start';
      updateTimerDisplay();
    }

    function updateTimerDisplay() {
      const minutes = Math.floor(timerSeconds / 60);
      const seconds = timerSeconds % 60;
      document.getElementById('timer-display').textContent = 
        `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    }

    // Search functionality
    function searchNodes(query) {
      const nodes = document.querySelectorAll('.node');
      const lowerQuery = query.toLowerCase();
      
      nodes.forEach(node => {
        const text = node.textContent.toLowerCase();
        if (text.includes(lowerQuery) || query === '') {
          node.style.display = 'block';
          node.style.opacity = '1';
        } else {
          node.style.opacity = '0.2';
        }
      });
    }

    // Attach event listeners
    function attachEventListeners() {
      // Navigation
      document.querySelectorAll('.nav-menu a').forEach(link => {
        link.addEventListener('click', (e) => {
          e.preventDefault();
          const view = e.target.dataset.view;
          
          document.querySelectorAll('.nav-menu a').forEach(l => l.classList.remove('active'));
          e.target.classList.add('active');
          
          document.getElementById('map-view').style.display = view === 'map' || view === 'dashboard' ? 'block' : 'none';
          document.getElementById('desk-view').style.display = view === 'dashboard' ? 'flex' : 'none';
          document.getElementById('notes-view').classList.toggle('active', view === 'notes');
          
          if (view === 'themes') {
            document.querySelector('[data-theme]').scrollIntoView({ behavior: 'smooth' });
          }
        });
      });

      // Theme switcher
      document.querySelectorAll('.theme-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          switchTheme(btn.dataset.theme);
        });
      });

      // Notes toggle
      document.querySelectorAll('.notes-toggle button').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.notes-toggle button').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          
          const mode = btn.dataset.mode;
          document.getElementById('sticky-notes-area').style.display = mode === 'sticky' ? 'block' : 'none';
          document.getElementById('noteit-area').style.display = mode === 'noteit' ? 'block' : 'none';
        });
      });

      // Add note button
      document.getElementById('add-note-btn').addEventListener('click', addNote);

      // Timer controls
      document.getElementById('timer-toggle').addEventListener('click', () => {
        document.getElementById('timer-widget').classList.toggle('active');
      });
      
      document.getElementById('timer-start').addEventListener('click', startTimer);
      document.getElementById('timer-reset').addEventListener('click', resetTimer);

      // Refresh button
      document.getElementById('refresh-btn').addEventListener('click', () => {
        renderMap();
      });

      // NoteIt button
      document.getElementById('noteit-btn').addEventListener('click', () => {
        window.open('https://perchance.org/noteit-shanks', '_blank', 'noopener,noreferrer');
      });

      // Search
      document.getElementById('search-input').addEventListener('input', (e) => {
        searchNodes(e.target.value);
      });
    }

    // Make functions globally accessible
    window.openDeskView = openDeskView;
    window.deleteNote = deleteNote;
    window.updateNote = updateNote;

    // Initialize on load
    init();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99cecc7b51930d2d',t:'MTc2Mjg3NDY5MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>